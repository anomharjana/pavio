<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Item Analysis Tool</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      background-color: #2563eb;
      color: white;
      width: 100%;
      padding: 1rem;
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
    }
    main {
      width: 95%;
      max-width: 1000px;
      background: white;
      margin-top: 1rem;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    input[type="file"], input[type="number"] {
      width: 100%;
      padding: 0.6rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
    }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.2rem;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #1e40af;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
      text-align: left;
      font-size: 0.9rem;
    }
    th {
      background-color: #f0f4f8;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    select {
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 48%;
    }
    @media (max-width: 600px) {
      main {
        padding: 1rem;
      }
      button {
        width: 100%;
        margin-bottom: 0.5rem;
      }
      select {
        width: 100%;
      }
      table, th, td {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <header>Analisis Butir Soal (Item Analysis Tool)</header>
  <main>
    <label>Unggah File CSV:</label>
    <input type="file" id="csvInput" accept=".csv">

    <label>Jumlah Peserta Ujian:</label>
    <input type="number" id="totalParticipants" placeholder="Masukkan jumlah peserta">

    <button onclick="analyzeCSV()">Analisis Soal</button>
    <button onclick="demoMode()">Mode Demo</button>

    <div class="filters">
      <select id="filterBloom" onchange="applyFilters()">
        <option value="">Filter Taksonomi Bloom</option>
      </select>
      <select id="filterDifficulty" onchange="applyFilters()">
        <option value="">Filter Tingkat Kesulitan</option>
        <option value="Mudah">Mudah</option>
        <option value="Sedang">Sedang</option>
        <option value="Sulit">Sulit</option>
      </select>
    </div>

    <div class="table-container">
      <table id="resultTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Soal</th>
            <th>Tingkat Kesulitan</th>
            <th>Nilai P</th>
            <th>Bloom Level</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <canvas id="chartDifficulty" style="width:100%;max-width:400px;margin-top:1rem;"></canvas>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let dataItems = [];

    function parseCSV(content) {
      const rows = content.trim().split('\n');
      return rows.slice(1).map((row, index) => {
        const [soal, benar] = row.split(',');
        return { id: index+1, soal: soal.trim(), benar: parseInt(benar.trim()) };
      });
    }

    function classifyBloom(text) {
      const lower = text.toLowerCase();
      if (lower.match(/sebutkan|ingat|identifikasi/)) return 'Remember';
      if (lower.match(/jelaskan|uraikan|deskripsikan/)) return 'Understand';
      if (lower.match(/gunakan|hitung|tentukan|terapkan/)) return 'Apply';
      if (lower.match(/bandingkan|analisis|kelompokkan/)) return 'Analyze';
      if (lower.match(/nilai|tentukan terbaik|kritik/)) return 'Evaluate';
      if (lower.match(/rancang|buat|susun/)) return 'Create';
      return 'Understand';
    }

    function analyzeCSV() {
      const fileInput = document.getElementById('csvInput');
      const total = parseInt(document.getElementById('totalParticipants').value);
      if (!fileInput.files[0] || !total) {
        alert('Unggah file CSV dan masukkan jumlah peserta.');
        return;
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = e.target.result;
        dataItems = parseCSV(content);
        dataItems.forEach(item => {
          const P = item.benar / total;
          if (P > 0.7) item.kesulitan = 'Mudah';
          else if (P >= 0.3) item.kesulitan = 'Sedang';
          else item.kesulitan = 'Sulit';
          item.P = P.toFixed(2);
          item.bloom = classifyBloom(item.soal);
        });
        displayResults();
      };
      reader.readAsText(fileInput.files[0]);
    }

    function displayResults() {
      const tbody = document.querySelector('#resultTable tbody');
      tbody.innerHTML = '';
      dataItems.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.id}</td><td>${item.soal}</td><td>${item.kesulitan}</td><td>${item.P}</td><td>${item.bloom}</td>`;
        tbody.appendChild(tr);
      });
      updateChart();
      populateBloomFilter();
    }

    function populateBloomFilter() {
      const select = document.getElementById('filterBloom');
      const blooms = [...new Set(dataItems.map(i => i.bloom))];
      select.innerHTML = '<option value="">Filter Taksonomi Bloom</option>' + blooms.map(b => `<option value="${b}">${b}</option>`).join('');
    }

    function applyFilters() {
      const bloom = document.getElementById('filterBloom').value;
      const diff = document.getElementById('filterDifficulty').value;
      const tbody = document.querySelector('#resultTable tbody');
      tbody.innerHTML = '';
      dataItems.filter(i => (!bloom || i.bloom === bloom) && (!diff || i.kesulitan === diff)).forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.id}</td><td>${item.soal}</td><td>${item.kesulitan}</td><td>${item.P}</td><td>${item.bloom}</td>`;
        tbody.appendChild(tr);
      });
    }

    function updateChart() {
      const ctx = document.getElementById('chartDifficulty');
      const counts = { Mudah: 0, Sedang: 0, Sulit: 0 };
      dataItems.forEach(i => counts[i.kesulitan]++);
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(counts),
          datasets: [{ data: Object.values(counts), backgroundColor: ['#22c55e','#facc15','#ef4444'] }]
        }
      });
    }

    function demoMode() {
      const demoCSV = 'soal,jumlah_benar\nSebutkan ciri makhluk hidup,80\nJelaskan proses fotosintesis,50\nGunakan rumus luas lingkaran,30\nAnalisis hasil percobaan,20\nRancang alat ukur sederhana,10';
      document.getElementById('totalParticipants').value = 100;
      dataItems = parseCSV(demoCSV);
      dataItems.forEach(item => {
        const P = item.benar / 100;
        if (P > 0.7) item.kesulitan = 'Mudah';
        else if (P >= 0.3) item.kesulitan = 'Sedang';
        else item.kesulitan = 'Sulit';
        item.P = P.toFixed(2);
        item.bloom = classifyBloom(item.soal);
      });
      displayResults();
    }
  </script>
</body>
</html>
